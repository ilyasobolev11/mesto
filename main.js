(()=>{"use strict";var t={11:(t,e,n)=>{t.exports=n.p+"images/img-placeholder.1b4df08a32eda4785bca.jpg"}},e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.p="",(()=>{var t=".elements__list",e={formSelector:".popup__form",inputSelector:".popup__input",inputErrorClass:"popup__input_type_error",submitButtonSelector:".popup__submit-btn",disabledButtonClass:"popup__submit-btn_disabled"},r=document.querySelector(".profile__edit-btn"),i=document.querySelector(".profile__add-btn"),o=document.querySelector(".profile__cover"),a=n(11);function s(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var c=function(){function t(e,n){var r=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),u(this,"resetValidation",(function(){r._inputList.forEach((function(t){return r._hideInputError(t)})),r._toggleButtonState()})),u(this,"enableValidation",(function(){r._formElement.addEventListener("submit",(function(t){return t.preventDefault()})),r._setEventListeners()})),this._config=e,this._formElement=document.querySelector(n)}var e,n;return e=t,(n=[{key:"_enableButton",value:function(){this._submitButtonElement.classList.remove(this._config.disabledButtonClass),this._submitButtonElement.removeAttribute("disabled")}},{key:"_disableButton",value:function(){this._submitButtonElement.classList.add(this._config.disabledButtonClass),this._submitButtonElement.setAttribute("disabled","true")}},{key:"_toggleButtonState",value:function(){this._formElement.checkValidity()?this._enableButton():this._disableButton()}},{key:"_hideInputError",value:function(t){var e=this._formElement.querySelector("#".concat(t.id,"-error"));t.classList.remove(this._config.inputErrorClass),e.textContent=""}},{key:"_showInputError",value:function(t){var e=this._formElement.querySelector("#".concat(t.id,"-error"));t.classList.add(this._config.inputErrorClass),e.textContent=t.validationMessage}},{key:"_checkInputValidity",value:function(t){t.validity.valid?this._hideInputError(t):this._showInputError(t)}},{key:"_setEventListeners",value:function(){var t=this;this._submitButtonElement=this._formElement.querySelector(this._config.submitButtonSelector),this._inputList=this._formElement.querySelectorAll(this._config.inputSelector),this._inputList.forEach((function(e){e.addEventListener("input",(function(){t._checkInputValidity(e),t._toggleButtonState()}))}))}}])&&s(e.prototype,n),t}();function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var f=function(){function t(e,n,r,i,o,a,s,u){var c=e.name,l=e.link,f=e.likes,p=e._id,h=e.owner;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._name=c,this._link=l,this.likes=f,this.id=p,this._cardOwnerId=h._id,this._templateSelector=n,this._currentUserId=r,this._cardImgClickHandler=i,this._deleteBtnClickHandler=o,this._putLikeHandler=a,this._removeLikeHandler=s,this._imgPlaceholder=u}var e,n;return e=t,(n=[{key:"_getTemplate",value:function(){return document.querySelector(this._templateSelector).content.querySelector(".elements__item").cloneNode(!0)}},{key:"toggleLikeBtnState",value:function(){this._likeButton.classList.toggle("elements__like-btn_active")}},{key:"likeBtnClickHandler",value:function(){this.toggleLikeBtnState(),this._likeButton.classList.contains("elements__like-btn_active")?this._putLikeHandler(this):this._removeLikeHandler(this)}},{key:"_setLikesInitialValue",value:function(){var t=this;this._likeState=this.likes.some((function(e){return e._id===t._currentUserId})),this._likeState&&this._likeButton.classList.add("elements__like-btn_active")}},{key:"updateLikesCount",value:function(){this._likesCountElement.textContent=this.likes.length}},{key:"_setEventListeners",value:function(){var t=this;this._likeButton.addEventListener("click",(function(){return t.likeBtnClickHandler()})),this._likeButton.addEventListener("mousedown",(function(t){return t.preventDefault()})),this._imgElement.addEventListener("click",(function(){t._cardImgClickHandler(t._link,t._name)})),this._deleteButton&&this._deleteButton.addEventListener("click",(function(){t._deleteBtnClickHandler(t)}))}},{key:"_checkOwner",value:function(){this._cardOwnerId!==this._currentUserId&&(this._deleteButton.remove(),this._deleteButton=void 0)}},{key:"generateCardElement",value:function(){var t=this;return this.cardElement=this._getTemplate(),this._imgElement=this.cardElement.querySelector(".elements__item-img"),this._likeButton=this.cardElement.querySelector(".elements__like-btn"),this._likesCountElement=this.cardElement.querySelector(".elements__likes-count"),this._deleteButton=this.cardElement.querySelector(".elements__delete-btn"),this._checkOwner(),this._setEventListeners(),this.cardElement.querySelector(".elements__item-title").textContent=this._name,this._imgElement.src=this._link,this._imgElement.alt="Фото - ".concat(this._name),this._setLikesInitialValue(),this.updateLikesCount(),this._imgElement.onerror=function(){t._imgPlaceholder&&(t._imgElement.src=t._imgPlaceholder)},this.cardElement}}])&&l(e.prototype,n),t}();function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var d=function(){function t(e,n){var r=e.render,i=e.checkContainer;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._render=r,this._checkContainer=i,this._container=document.querySelector(n)}var e,n;return e=t,(n=[{key:"addItem",value:function(t,e){e?this._container.append(t):this._container.prepend(t),this._checkContainer&&this._checkContainer()}},{key:"renderItems",value:function(t){var e=this;t.length>0?t.forEach((function(t){return e.addItem(e._render(t),!0)})):this._checkContainer&&this._checkContainer()}}])&&h(e.prototype,n),t}();function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function m(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var y=function(){function t(e){var n,r,i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(t){"Escape"===t.key&&i.close()},(n="_handleEscClose")in this?Object.defineProperty(this,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[n]=r,this.popup=document.querySelector(e),this.open=this.open.bind(this)}var e,n;return e=t,(n=[{key:"open",value:function(){this.popup.classList.add("popup_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"close",value:function(){this.popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._handleEscClose)}},{key:"_handlePopupOverlayClick",value:function(t){t.target.classList.contains("popup")&&this.close()}},{key:"setEventListeners",value:function(){var t=this;this.popup.querySelector(".popup__close-btn").addEventListener("click",(function(){return t.close()})),this.popup.addEventListener("mousedown",this._handlePopupOverlayClick.bind(this))}}])&&m(e.prototype,n),t}();function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function b(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function g(t,e,n){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=C(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function E(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function C(t){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=C(r);if(i){var n=C(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return E(this,t)});function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this,t))._imgElement=e.popup.querySelector(".popup__img"),e._imgCaptionElement=e.popup.querySelector(".popup__img-caption"),e}return e=a,(n=[{key:"open",value:function(t,e){g(C(a.prototype),"open",this).call(this),this._imgElement.src=t,this._imgElement.alt="Фото - ".concat(e),this._imgCaptionElement.textContent=e}}])&&b(e.prototype,n),a}(y);function S(t){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function L(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function O(t,e,n){return(O="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=j(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(n):i.value}})(t,e,n||t)}function B(t,e){return(B=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function P(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function j(t){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var x=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&B(t,e)}(a,t);var e,n,r,i,o=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=j(r);if(i){var n=j(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return P(this,t)});function a(t,e,n,r,i){var s;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(s=o.call(this,t))._form=s.popup.querySelector(".popup__form"),s._inputList=s._form.querySelectorAll(".popup__input"),s.submitButton=s._form.querySelector(".popup__submit-btn"),s.submitButtonText=n,s._submitHandler=e,s._resetValidation=r,s._getInitialValues=i,s._setEventListeners(),s}return e=a,(n=[{key:"_getInputValues",value:function(){var t=this;if(this._inputList)return this._inputValues={},this._inputList.forEach((function(e){return t._inputValues[e.name]=e.value})),this._inputValues}},{key:"_setInputValues",value:function(){var t=this;this._inputList.forEach((function(e){return e.value=t._initialValues[e.name]}))}},{key:"_setEventListeners",value:function(){var t=this;O(j(a.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",(function(e){e.preventDefault(),t.submitButtonText&&(t.submitButton.textContent=t.submitButtonText.submitProcess),t._submitHandler(t._getInputValues())}))}},{key:"open",value:function(t){O(j(a.prototype),"open",this).call(this),this._resetValidation&&this._resetValidation(),this.submitButtonText&&(this.submitButton.textContent=this.submitButtonText.default),this._getInitialValues&&(this._initialValues=this._getInitialValues(),this._setInputValues()),t&&(this.currentCard=t)}},{key:"close",value:function(){O(j(a.prototype),"close",this).call(this),this._form.reset()}}])&&L(e.prototype,n),a}(y);function I(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function T(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?I(Object(n),!0).forEach((function(e){q(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function q(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function V(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function D(t){console.log(t)}function U(t){return new f(t,"#card-template",M.userId,Y.open,X.open,A,N,a).generateCardElement()}function A(t){H.putLike("/cards/likes/".concat(t.id)).then((function(e){var n=e.likes;t.likes=n,t.updateLikesCount()})).catch((function(e){D(e),t.toggleLikeBtnState()}))}function N(t){H.removeLike("/cards/likes/".concat(t.id)).then((function(e){var n=e.likes;t.likes=n,t.updateLikesCount()})).catch((function(e){D(e),t.toggleLikeBtnState()}))}var H=new(function(){function t(e){var n=e.url,r=e.token;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._url=n,this._token=r}var e,n;return e=t,(n=[{key:"_getResponseBody",value:function(t,e){return t.ok?t.json():Promise.reject(new Error("Ошибка ".concat(e,": ").concat(t.status," - ").concat(t.statusText)))}},{key:"getUserData",value:function(t){var e=this;return fetch("".concat(this._url).concat(t),{headers:this._token}).then((function(t){return e._getResponseBody(t,"getUserData")}))}},{key:"getInitialCards",value:function(t){var e=this;return fetch("".concat(this._url).concat(t),{headers:this._token}).then((function(t){return e._getResponseBody(t,"getInitialCards")}))}},{key:"updateUserData",value:function(t,e){var n=this,r=t.userName,i=t.status;return fetch("".concat(this._url).concat(e),{method:"PATCH",headers:T(T({},this._token),{},{"Content-Type":"application/json"}),body:JSON.stringify({name:r,about:i})}).then((function(t){return n._getResponseBody(t,"updateUserData")}))}},{key:"updateAvatar",value:function(t,e){var n=this;return fetch("".concat(this._url).concat(e),{method:"PATCH",headers:T(T({},this._token),{},{"Content-Type":"application/json"}),body:JSON.stringify(t)}).then((function(t){return n._getResponseBody(t,"updateAvatar")}))}},{key:"sendNewCard",value:function(t,e){var n=this;return fetch("".concat(this._url).concat(e),{method:"POST",headers:T(T({},this._token),{},{"Content-Type":"application/json"}),body:JSON.stringify(t)}).then((function(t){return n._getResponseBody(t,"sendNewCard")}))}},{key:"deleteCard",value:function(t){var e=this;return fetch("".concat(this._url).concat(t),{method:"DELETE",headers:this._token}).then((function(t){return e._getResponseBody(t,"deleteCard")}))}},{key:"putLike",value:function(t){var e=this;return fetch("".concat(this._url).concat(t),{method:"PUT",headers:this._token}).then((function(t){return e._getResponseBody(t,"putLike")}))}},{key:"removeLike",value:function(t){var e=this;return fetch("".concat(this._url).concat(t),{method:"DELETE",headers:this._token}).then((function(t){return e._getResponseBody(t,"removeLike")}))}}])&&V(e.prototype,n),t}())({url:"https://mesto.nomoreparties.co/v1/cohort-20",token:{authorization:"614d3213-6f90-4cae-80f4-7341542ff306"}}),J=new function t(e,n,r){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,"check",(function(){i._container.hasChildNodes()?i._textNotification.classList.remove(i._visibleTextNotificationClass):i._textNotification.classList.add(i._visibleTextNotificationClass)})),p(this,"toggleLoadingSpinnerVisibility",(function(){i._loagingSpinner.classList.toggle(i._visibleLoagingSpinnerClass)})),this._container=document.querySelector(r),this._textNotification=document.querySelector(e.selector),this._loagingSpinner=document.querySelector(n.selector),this._visibleTextNotificationClass=e.visibleElementClass,this._visibleLoagingSpinnerClass=n.visibleElementClass}({selector:".elements__text-notification",visibleElementClass:"elements__text-notification_visible"},{selector:".elements__spinner",visibleElementClass:"elements__spinner_hidden"},t),z=new d({render:U,checkContainer:J.check},t),M=new function t(e,n,r){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),_(this,"getUserInfo",(function(){return{userName:i._nameElement.textContent,status:i._statusElement.textContent}})),_(this,"setUserInfo",(function(t){var e=t.name,n=t.about,r=t.avatar,o=t._id;i._nameElement.textContent=e,i._statusElement.textContent=n,i.userId=o,i._avatarElement.src=r})),this._nameElement=document.querySelector(e),this._statusElement=document.querySelector(n),this._avatarElement=document.querySelector(r)}(".profile__user-name",".profile__user-status",".profile__avatar"),$=new c(e,".popup_type_edit-avatar .popup__form");$.enableValidation();var F=new c(e,".popup_type_edit-profile .popup__form");F.enableValidation();var G=new c(e,".popup_type_create-card .popup__form");G.enableValidation();var K=new x(".popup_type_edit-avatar",(function(t){H.updateAvatar(t,"/users/me/avatar").then((function(t){M.setUserInfo(t)})).catch(D).finally((function(){K.close(),K.submitButton.textContent=K.submitButtonText.ready}))}),{default:"Сохранить",submitProcess:"Сохранение...",ready:"Готово"},$.resetValidation),Q=new x(".popup_type_edit-profile",(function(t){H.updateUserData(t,"/users/me").then((function(t){M.setUserInfo(t)})).catch(D).finally((function(){Q.close(),Q.submitButton.textContent=Q.submitButtonText.ready}))}),{default:"Сохранить",submitProcess:"Сохранение...",ready:"Готово"},F.resetValidation,M.getUserInfo),W=new x(".popup_type_create-card",(function(t){H.sendNewCard(t,"/cards ").then((function(t){z.addItem(U(t))})).catch(D).finally((function(){W.close(),W.submitButton.textContent=W.submitButtonText.ready}))}),{default:"Создать",submitProcess:"Создание...",ready:"Готово"},G.resetValidation),X=new x(".popup_type_confirm-delete-card",(function(){H.deleteCard("/cards/".concat(X.currentCard.id)).then((function(t){console.log(t.message),X.currentCard.cardElement.remove(),J.check()})).catch(D).finally((function(){X.close(),X.submitButton.textContent=X.submitButtonText.ready}))}),{default:"Да",submitProcess:"Удаление...",ready:"Готово"}),Y=new w(".popup_type_zoom-img");Y.setEventListeners(),document.querySelectorAll("button").forEach((function(t){t.addEventListener("mousedown",(function(t){return t.preventDefault()}))})),o.addEventListener("mousedown",(function(t){return t.preventDefault()})),o.addEventListener("click",(function(){K.open()})),r.addEventListener("click",(function(){Q.open()})),i.addEventListener("click",(function(){W.open()})),Promise.all([H.getUserData("/users/me"),H.getInitialCards("/cards")]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}(e,n)||function(t,e){if(t){if("string"==typeof t)return R(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=r[0],o=r[1];M.setUserInfo(i),J.toggleLoadingSpinnerVisibility(),z.renderItems(o)})).catch((function(t){return console.log(t)}))})()})();
//# sourceMappingURL=main.js.map